# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Glacier

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ –∏ DevOps-–∏–Ω–∂–µ–Ω–µ—Ä–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

## üß† –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** üìä ‚Äî –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- **–õ–µ–≥–∞–ª—å–Ω–æ—Å—Ç—å** üõ°Ô∏è ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã  
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã** üìà ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ NetFlow v9 (RFC 3954)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** üé® ‚Äî HTML –∏ YAML –æ—Ç—á–µ—Ç—ã

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
analyzer.py (–ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
    |
    v
–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (psutil, netstat, lsof, ss)
    |
    v  
NetFlow v9 –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (RFC 3954)
    |
    v
–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (ReportEnhancer)
    |
    v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  YAML –æ—Ç—á–µ—Ç ‚îÇ  HTML –æ—Ç—á–µ—Ç ‚îÇ
‚îÇ             ‚îÇ (Chart.js)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    |
    v
S3 –∑–∞–≥—Ä—É–∑–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## üîç –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### 1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö üìä

**–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- `psutil.net_connections()` ‚Äî TCP/UDP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `netstat` ‚Äî fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–∏—Å—Ç–µ–º
- `lsof` ‚Äî –ø—Ä–æ—Ü–µ—Å—Å—ã —Å —Å–µ—Ç–µ–≤—ã–º–∏ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏
- `ss` ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ netstat

**–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- `psutil` ‚Äî CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫–∏, –ø—Ä–æ—Ü–µ—Å—Å—ã
- `platform` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –û–°
- `/proc/net/` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã Linux (read-only)
- `dscl` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ macOS

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- `iptables -L` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
- `ufw status` ‚Äî Ubuntu Firewall
- `docker ps` ‚Äî —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### 2. NetFlow v9 –æ–±—Ä–∞–±–æ—Ç–∫–∞ üì°

–°—Ç—Ä–æ–≥–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ **RFC 3954**:

```python
NETFLOW_V9_FIELDS = {
    'IN_BYTES': 1,          # –í—Ö–æ–¥—è—â–∏–µ –±–∞–π—Ç—ã
    'IN_PKTS': 2,           # –í—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã  
    'PROTOCOL': 4,          # IP protocol (TCP=6, UDP=17, ICMP=1)
    'L4_SRC_PORT': 7,       # TCP/UDP source port
    'IPV4_SRC_ADDR': 8,     # IPv4 source address
    'L4_DST_PORT': 11,      # TCP/UDP destination port
    'IPV4_DST_ADDR': 12,    # IPv4 destination address
    'FIRST_SWITCHED': 22,   # First packet timestamp
    'LAST_SWITCHED': 21,    # Last packet timestamp
}
```

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ NetFlow v9:**
- Version = 9
- Count (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π)
- SysUptime (–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –≤ –º—Å)
- Unix Secs (timestamp —ç–∫—Å–ø–æ—Ä—Ç–∞)
- Sequence Number
- Source ID

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ üßê

`ReportEnhancer` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:

```python
def enhance_report(self, original_report):
    return {
        'metadata': self._create_metadata(),
        'executive_summary': self._create_summary(),
        'security_analysis': self._analyze_security(),
        'network_analysis': self._analyze_network(),
        'system_health': self._analyze_health(),
        'recommendations': self.recommendations,
        'detailed_data': self._structure_data()
    }
```

**–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:**
- –¢–æ–ø –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º
- –ê–Ω–æ–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ üìã

**YAML (NetFlow v9):**
```yaml
netflow_data:
  header:
    version: 9
    count: 145
    sys_uptime: 1234567
    unix_secs: 1735123456
  flows:
    - ipv4_src_addr: "192.168.1.100"
      ipv4_dst_addr: "93.184.216.34"
      l4_src_port: 54321
      l4_dst_port: 443
      protocol: 6
```

**HTML:**
- Chart.js –¥–∏–∞–≥—Ä–∞–º–º—ã
- Bootstrap UI
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞

### 5. –í—ã–≥—Ä—É–∑–∫–∞ üíæ

- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã: `hostname_os_report_analyzer.{yaml,html}`
- S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üõ°Ô∏è –ú–µ—Ç–æ–¥—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã:**
- `psutil` ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `socket` ‚Äî —Å–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏  
- `subprocess` ‚Äî –≤—ã–∑–æ–≤ —É—Ç–∏–ª–∏—Ç

**–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã:**
- NetFlow v9 (RFC 3954)
- YAML/JSON
- HTML5/CSS3/JS

**–ú–µ—Ç–æ–¥—ã:**
1. –ü–∞—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—á—Ç–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
2. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã (/proc/net/, —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
3. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (netstat, ss, lsof)
4. –ü—É–±–ª–∏—á–Ω—ã–µ API

### ‚ùå –ß—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º
- Packet capture
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ backdoor'–æ–≤
- –°–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π/–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤

## üîÑ NetFlow v9 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```
+--------+--------+--------+--------+
|       Version Number = 9         |  
+--------+--------+--------+--------+
|          Count                   |
+--------+--------+--------+--------+
|         System Uptime            |
+--------+--------+--------+--------+
|         UNIX Seconds             |
+--------+--------+--------+--------+
|       Sequence Number            |
+--------+--------+--------+--------+
|        Source ID                 |
+--------+--------+--------+--------+
```

### Template Records
```python
def create_template_record(self, template_id, fields):
    return {
        'template_id': template_id,
        'field_count': len(fields),
        'field_specs': [
            {'field_type': NETFLOW_V9_FIELDS[field],
             'field_length': FIELD_LENGTHS[field]}
            for field in fields
        ]
    }
```

### Data Records
```python
def convert_connection_to_flow(self, connection):
    return {
        'ipv4_src_addr': self.parse_ip(connection['local']),
        'ipv4_dst_addr': self.parse_ip(connection['remote']),
        'l4_src_port': self.parse_port(connection['local']),
        'l4_dst_port': self.parse_port(connection['remote']),
        'protocol': PROTOCOL_NUMBERS[connection['type']],
        'first_switched': int(time.time()),
        'last_switched': int(time.time())
    }
```

## üöÄ –ú–æ–¥—É–ª–∏

### analyzer.py ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
```python
def main():
    system_data = collect_system_data()
    netflow_data = NetFlowGenerator().generate_netflow_report(system_data)
    enhanced = ReportEnhancer().enhance_report(netflow_data)
    HTMLReportGenerator().generate_html_report(enhanced)
    write_yaml_report(netflow_data)
    upload_to_s3_if_configured()
```

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- **network_info.py** ‚Äî TCP/UDP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø–æ—Ä—Ç—ã
- **udp_tracker_{module,macos}.py** ‚Äî UDP —Ç—Ä–∞—Ñ–∏–∫, DNS
- **icmp_tracker.py** ‚Äî ping, traceroute, ICMP
- **report_enhancer.py** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, –º–µ—Ç—Ä–∏–∫–∏
- **html_report_generator.py** ‚Äî HTML –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, Chart.js

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.6+**
- **psutil** ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **PyYAML** ‚Äî YAML –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **boto3** ‚Äî S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **Chart.js** ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏
- **Bootstrap** ‚Äî UI

## üìä –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

```yaml
netflow_data:
  header: {version: 9, count: 156, sys_uptime: 1234567}
system_info:
  hostname: server.example.com
  os: {name: Linux, version: 5.4.0}
connections:
  incoming: [...]
  outgoing: [...]
statistics:
  measurement_count: 10
  duration_seconds: 300
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
2. Read-only –æ–ø–µ—Ä–∞—Ü–∏–∏
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
4. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
- IP –∞–¥—Ä–µ—Å–∞ ‚Äî —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ—Ü–µ—Å—Å—ã ‚Äî —Ç–æ–ª—å–∫–æ —Å–µ—Ç–µ–≤—ã–µ, –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Äî —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- –§–∞–π–ª—ã ‚Äî –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∑–∞–º–µ–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SIEM (Splunk, Elastic)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã, S3, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---